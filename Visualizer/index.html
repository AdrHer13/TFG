<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Visualizador</title>


    <!-- Stylesheets -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
    <link rel="stylesheet" href="CSS/general.css">

    <!-- Scripts -->

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.5/dist/umd/popper.min.js" integrity="sha384-Xe+8cL9oJa6tN/veChSP7q+mnSPaj5Bcu9mPX5F5xIGE0DVittaqT5lorf0EI7Vk" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous"></script>

    <script src="https://kit.fontawesome.com/7c89af0f82.js" crossorigin="anonymous"></script>
</head>

<body>
    <!-- APP -->
    <div class="content" style="height: 100vh; background: gray;">
        <!-- Partida -->
        <div class="row">

            <!-- Col Jugadores -->
            <div class="col-3">
                <div style="background: lightcoral" class="playerprofile" id="P0">
                    <div>
                        <img src="Images/nouser.png" alt="No user" height="100px">
                        <h1>J1</h1>
                        <h3 id="puntos_victoria_J1"></h3>
                        <textarea id="buildings_P1" style="width: 100%"></textarea>
                    </div>
                </div>
                <div id="hand_P0" class="hand hand-bottom text-center">
                    <div class="cereal d-inline-block px-1" style="border-right: 1px solid black; border-left: 1px solid black;">
                        <i class="fa-solid fa-wheat-awn"></i>
                        <span>: </span>
                        <span class="cereal_quantity">0</span>
                    </div>
                    <div class="bricks d-inline-block px-1" style="border-right: 1px solid black; border-left: 1px solid black;">
                        <i class="fa-solid fa-trowel-bricks"></i>
                        <span>: </span>
                        <span class="bricks_quantity">0</span>
                    </div>
                    <div class="wool d-inline-block px-1" style="border-right: 1px solid black; border-left: 1px solid black;">
                        <i class="fa-brands fa-cotton-bureau"></i>
                        <span>: </span>
                        <span class="wool_quantity">0</span>
                    </div>
                    <div class="wood d-inline-block px-1" style="border-right: 1px solid black; border-left: 1px solid black;">
                        <i class="fa-solid fa-wand-sparkles"></i>
                        <span>: </span>
                        <span class="wood_quantity">0</span>
                    </div>
                    <div class="ore d-inline-block px-1" style="border-right: 1px solid black; border-left: 1px solid black;">
                        <i class="fa-solid fa-mountain-sun"></i>
                        <span>: </span>
                        <span class="ore_quantity">0</span>
                    </div>
                </div>
                <div id="hand_P2" class="hand hand-top text-center">
                    <div class="cereal d-inline-block px-1" style="border-right: 1px solid black; border-left: 1px solid black;">
                        <i class="fa-solid fa-wheat-awn"></i>
                        <span>: </span>
                        <span class="cereal_quantity">0</span>
                    </div>
                    <div class="bricks d-inline-block px-1" style="border-right: 1px solid black; border-left: 1px solid black;">
                        <i class="fa-solid fa-trowel-bricks"></i>
                        <span>: </span>
                        <span class="bricks_quantity">0</span>
                    </div>
                    <div class="wool d-inline-block px-1" style="border-right: 1px solid black; border-left: 1px solid black;">
                        <i class="fa-brands fa-cotton-bureau"></i>
                        <span>: </span>
                        <span class="wool_quantity">0</span>
                    </div>
                    <div class="wood d-inline-block px-1" style="border-right: 1px solid black; border-left: 1px solid black;">
                        <i class="fa-solid fa-wand-sparkles"></i>
                        <span>: </span>
                        <span class="wood_quantity">0</span>
                    </div>
                    <div class="ore d-inline-block px-1" style="border-right: 1px solid black; border-left: 1px solid black;">
                        <i class="fa-solid fa-mountain-sun"></i>
                        <span>: </span>
                        <span class="ore_quantity">0</span>
                    </div>
                </div>
                <div style="background: lightgreen" class="playerprofile" id="P2">
                    <img src="Images/nouser.png" alt="No user" height="100px">
                    <h1>J3</h1>
                    <h3 id="puntos_victoria_J3"></h3>
                    <textarea id="buildings_P3" style="width: 100%"></textarea>
                </div>
            </div>

            <!-- Col Partida -->
            <div class="col-6 mb-5">
                <div id="diceroll">Diceroll: 0</div>
                <div class="gamefield text-center" style="background: gray;">
                    <div class="terrain_pieces">
                        <div class="terrain" id="terrain_0" style="top: 55px; left: 165px; background: green;"></div>
                        <div class="terrain" id="terrain_1" style="top: 55px; left: 320px; background: greenyellow;"></div>
                        <div class="terrain" id="terrain_2" style="top: 55px; left: 475px; background: yellow;"></div>

                        <div class="terrain" id="terrain_3" style="top: 135px; left: 85px; background: brown;"></div>
                        <div class="terrain" id="terrain_4" style="top: 135px; left: 240px; background: lightgray;"></div>
                        <div class="terrain" id="terrain_5" style="top: 135px; left: 395px; background: brown;"></div>
                        <div class="terrain" id="terrain_6" style="top: 135px; left: 555px; background: greenyellow;"></div>

                        <div class="terrain" id="terrain_7" style="top: 215px; left: 5px; background: orange;">X</div>
                        <div class="terrain" id="terrain_8" style="top: 215px; left: 165px; background: green;"></div>
                        <div class="terrain" id="terrain_9" style="top: 215px; left: 320px; background: yellow;"></div>
                        <div class="terrain" id="terrain_10" style="top: 215px; left: 475px; background: green;"></div>
                        <div class="terrain" id="terrain_11" style="top: 215px; left: 635px; background: yellow;"></div>

                        <div class="terrain" id="terrain_12" style="top: 295px; left: 85px; background: brown;"></div>
                        <div class="terrain" id="terrain_13" style="top: 295px; left: 240px; background: greenyellow;"></div>
                        <div class="terrain" id="terrain_14" style="top: 295px; left: 395px; background: greenyellow;"></div>
                        <div class="terrain" id="terrain_15" style="top: 295px; left: 555px; background: lightgray;"></div>

                        <div class="terrain" id="terrain_16" style="top: 375px; left: 165px; background: lightgray;"></div>
                        <div class="terrain" id="terrain_17" style="top: 375px; left: 320px; background: yellow;"></div>
                        <div class="terrain" id="terrain_18" style="top: 375px; left: 475px; background: green;"></div>
                    </div>
                    <div class="row" style="padding-top: 3em;">
                        <div class="col filler_node"></div>
                        <div class="col filler_road"></div>

                        <div class="col filler_node"></div>
                        <div class="col filler_road"></div>

                        <div class="col node" id="node_0"></div>
                        <div class="col road" id="road_0_1"></div>

                        <div class="col node" id="node_1"></div>
                        <div class="col road" id="road_1_2"></div>

                        <div class="col node" id="node_2"></div>
                        <div class="col road" id="road_2_3"></div>

                        <div class="col node" id="node_3"></div>
                        <div class="col road" id="road_3_4"></div>

                        <div class="col node" id="node_4"></div>
                        <div class="col road" id="road_4_5"></div>

                        <div class="col node" id="node_5"></div>
                        <div class="col road" id="road_5_6"></div>

                        <div class="col node" id="node_6"></div>
                        <div class="col filler_road"></div>

                        <div class="col filler_node"></div>
                        <div class="col filler_road"></div>

                        <div class="col filler_node"></div>
                    </div>
                    <div class="row roads">
                        <div class="col filler_node"></div>
                        <div class="col filler_road"></div>

                        <div class="col filler_node"></div>
                        <div class="col filler_road"></div>

                        <div class="vertical_road" id="road_0_8"></div>
                        <div class="col filler_road"></div>

                        <div class="col filler_node"></div>
                        <div class="col filler_road"></div>

                        <div class="vertical_road" id="road_2_10"></div>
                        <div class="col filler_road"></div>

                        <div class="col filler_node"></div>
                        <div class="col filler_road"></div>

                        <div class="vertical_road" id="road_4_12"></div>
                        <div class="col filler_road"></div>

                        <div class="col filler_node"></div>
                        <div class="col filler_road"></div>

                        <div class="vertical_road" id="road_6_14"></div>
                        <div class="col filler_road"></div>

                        <div class="col filler_node"></div>
                        <div class="col filler_road"></div>

                        <div class="col filler_node"></div>
                    </div>
                    <div class="row">
                        <div class="col filler_node"></div>
                        <div class="col filler_road"></div>

                        <div class="col node" id="node_7"></div>
                        <div class="col road" id="road_7_8"></div>

                        <div class="col node" id="node_8"></div>
                        <div class="col road" id="road_8_9"></div>

                        <div class="col node" id="node_9"></div>
                        <div class="col road" id="road_9_10"></div>

                        <div class="col node" id="node_10"></div>
                        <div class="col road" id="road_10_11"></div>

                        <div class="col node" id="node_11"></div>
                        <div class="col road" id="road_11_12"></div>

                        <div class="col node" id="node_12"></div>
                        <div class="col road" id="road_12_13"></div>

                        <div class="col node" id="node_13"></div>
                        <div class="col road" id="road_13_14"></div>

                        <div class="col node" id="node_14"></div>
                        <div class="col road" id="road_14_15"></div>

                        <div class="col node" id="node_15"></div>
                        <div class="col filler_road"></div>

                        <div class="col filler_node"></div>
                    </div>
                    <div class="row roads">
                        <div class="col filler_node"></div>
                        <div class="col filler_road"></div>

                        <div class="vertical_road" id="road_7_17"></div>
                        <div class="col filler_road"></div>

                        <div class="col filler_node"></div>
                        <div class="col filler_road"></div>

                        <div class="vertical_road" id="road_9_19"></div>
                        <div class="col filler_road"></div>

                        <div class="col filler_node"></div>
                        <div class="col filler_road"></div>

                        <div class="vertical_road" id="road_11_21"></div>
                        <div class="col filler_road"></div>

                        <div class="col filler_node"></div>
                        <div class="col filler_road"></div>

                        <div class="vertical_road" id="road_13_23"></div>
                        <div class="col filler_road"></div>

                        <div class="col filler_node"></div>
                        <div class="col filler_road"></div>

                        <div class="vertical_road" id="road_15_25"></div>
                        <div class="col filler_road"></div>

                        <div class="col filler_node"></div>
                    </div>
                    <div class="row">
                        <div class="col node" id="node_16"></div>
                        <div class="col road" id="road_16_17"></div>

                        <div class="col node" id="node_17"></div>
                        <div class="col road" id="road_17_18"></div>

                        <div class="col node" id="node_18"></div>
                        <div class="col road" id="road_18_19"></div>

                        <div class="col node" id="node_19"></div>
                        <div class="col road" id="road_19_20"></div>

                        <div class="col node" id="node_20"></div>
                        <div class="col road" id="road_20_21"></div>

                        <div class="col node" id="node_21"></div>
                        <div class="col road" id="road_21_22"></div>

                        <div class="col node" id="node_22"></div>
                        <div class="col road" id="road_22_23"></div>

                        <div class="col node" id="node_23"></div>
                        <div class="col road" id="road_23_24"></div>

                        <div class="col node" id="node_24"></div>
                        <div class="col road" id="road_24_25"></div>

                        <div class="col node" id="node_25"></div>
                        <div class="col road" id="road_25_26"></div>

                        <div class="col node" id="node_26"></div>
                    </div>

                    <div class="row roads">
                        <div class="vertical_road" id="road_16_27"></div>
                        <div class="col filler_road"></div>

                        <div class="col filler_node"></div>
                        <div class="col filler_road"></div>

                        <div class="vertical_road" id="road_18_29"></div>
                        <div class="col filler_road"></div>

                        <div class="col filler_node"></div>
                        <div class="col filler_road"></div>

                        <div class="vertical_road" id="road_20_31"></div>
                        <div class="col filler_road"></div>

                        <div class="col filler_node"></div>
                        <div class="col filler_road"></div>

                        <div class="vertical_road" id="road_22_33"></div>
                        <div class="col filler_road"></div>

                        <div class="col filler_node"></div>
                        <div class="col filler_road"></div>

                        <div class="vertical_road" id="road_24_35"></div>
                        <div class="col filler_road"></div>

                        <div class="col filler_node"></div>
                        <div class="col filler_road"></div>

                        <div class="vertical_road" id="road_26_37"></div>
                    </div>
                    <div class="row">
                        <div class="col node" id="node_27"></div>
                        <div class="col road" id="road_27_28"></div>

                        <div class="col node" id="node_28"></div>
                        <div class="col road" id="road_28_29"></div>

                        <div class="col node" id="node_29"></div>
                        <div class="col road" id="road_29_30"></div>

                        <div class="col node" id="node_30"></div>
                        <div class="col road" id="road_30_31"></div>

                        <div class="col node" id="node_31"></div>
                        <div class="col road" id="road_31_32"></div>

                        <div class="col node" id="node_32"></div>
                        <div class="col road" id="road_32_33"></div>

                        <div class="col node" id="node_33"></div>
                        <div class="col road" id="road_33_34"></div>

                        <div class="col node" id="node_34"></div>
                        <div class="col road" id="road_34_35"></div>

                        <div class="col node" id="node_35"></div>
                        <div class="col road" id="road_35_36"></div>

                        <div class="col node" id="node_36"></div>
                        <div class="col road" id="road_36_37"></div>

                        <div class="col node" id="node_37"></div>
                    </div>
                    <div class="row roads">
                        <div class="col filler_node"></div>
                        <div class="col filler_road"></div>

                        <div class="vertical_road" id="road_28_38"></div>
                        <div class="col filler_road"></div>

                        <div class="col filler_node"></div>
                        <div class="col filler_road"></div>

                        <div class="vertical_road" id="road_30_40"></div>
                        <div class="col filler_road"></div>

                        <div class="col filler_node"></div>
                        <div class="col filler_road"></div>

                        <div class="vertical_road" id="road_32_42"></div>
                        <div class="col filler_road"></div>

                        <div class="col filler_node"></div>
                        <div class="col filler_road"></div>

                        <div class="vertical_road" id="road_34_44"></div>
                        <div class="col filler_road"></div>

                        <div class="col filler_node"></div>
                        <div class="col filler_road"></div>

                        <div class="vertical_road" id="road_36_46"></div>
                        <div class="col filler_road"></div>

                        <div class="col filler_node"></div>
                    </div>
                    <div class="row">
                        <div class="col filler_node"></div>
                        <div class="col filler_road"></div>

                        <div class="col node" id="node_38"></div>
                        <div class="col road" id="road_38_39"></div>

                        <div class="col node" id="node_39"></div>
                        <div class="col road" id="road_39_40"></div>

                        <div class="col node" id="node_40"></div>
                        <div class="col road" id="road_40_41"></div>

                        <div class="col node" id="node_41"></div>
                        <div class="col road" id="road_41_42"></div>

                        <div class="col node" id="node_42"></div>
                        <div class="col road" id="road_42_43"></div>

                        <div class="col node" id="node_43"></div>
                        <div class="col road" id="road_43_44"></div>

                        <div class="col node" id="node_44"></div>
                        <div class="col road" id="road_44_45"></div>

                        <div class="col node" id="node_45"></div>
                        <div class="col road" id="road_45_46"></div>

                        <div class="col node" id="node_46"></div>
                        <div class="col filler_road"></div>

                        <div class="col filler_node"></div>
                    </div>
                    <div class="row roads">
                        <div class="col filler_node"></div>
                        <div class="col filler_road"></div>

                        <div class="col filler_node"></div>
                        <div class="col filler_road"></div>

                        <div class="vertical_road" id="road_39_47"></div>
                        <div class="col filler_road"></div>

                        <div class="col filler_node"></div>
                        <div class="col filler_road"></div>

                        <div class="vertical_road" id="road_41_49"></div>
                        <div class="col filler_road"></div>

                        <div class="col filler_node"></div>
                        <div class="col filler_road"></div>

                        <div class="vertical_road" id="road_43_51"></div>
                        <div class="col filler_road"></div>

                        <div class="col filler_node"></div>
                        <div class="col filler_road"></div>

                        <div class="vertical_road" id="road_45_53"></div>
                        <div class="col filler_road"></div>

                        <div class="col filler_node"></div>
                        <div class="col filler_road"></div>

                        <div class="col filler_node"></div>
                    </div>
                    <div class="row">
                        <div class="col filler_node"></div>
                        <div class="col filler_road"></div>

                        <div class="col filler_node"></div>
                        <div class="col filler_road"></div>

                        <div class="col node" id="node_47"></div>
                        <div class="col road" id="road_47_48"></div>

                        <div class="col node" id="node_48"></div>
                        <div class="col road" id="road_48_49"></div>

                        <div class="col node" id="node_49"></div>
                        <div class="col road" id="road_49_50"></div>

                        <div class="col node" id="node_50"></div>
                        <div class="col road" id="road_50_51"></div>

                        <div class="col node" id="node_51"></div>
                        <div class="col road" id="road_51_52"></div>

                        <div class="col node" id="node_52"></div>
                        <div class="col road" id="road_52_53"></div>

                        <div class="col node" id="node_53"></div>
                        <div class="col filler_road"></div>

                        <div class="col filler_node"></div>
                        <div class="col filler_road"></div>

                        <div class="col filler_node"></div>
                    </div>

                    <!--                    <img src="./Images/mapa.png" style="height: 57vh; margin-top: 5em" alt="Juego del Catan">-->
                </div>
            </div>

            <!-- Col Jugadores -->
            <div class="col-3">
                <div style="background: lightblue" class="playerprofile" id="P1">
                    <img src="Images/nouser.png" alt="No user" height="100px">
                    <h1>J2</h1>
                    <h3 id="puntos_victoria_J2"></h3>
                    <textarea id="buildings_P2" style="width: 100%"></textarea>
                </div>
                <div id="hand_P1" class="hand hand-bottom text-center">
                    <div class="cereal d-inline-block px-1" style="border-right: 1px solid black; border-left: 1px solid black;">
                        <i class="fa-solid fa-wheat-awn"></i>
                        <span>: </span>
                        <span class="cereal_quantity">0</span>
                    </div>
                    <div class="bricks d-inline-block px-1" style="border-right: 1px solid black; border-left: 1px solid black;">
                        <i class="fa-solid fa-trowel-bricks"></i>
                        <span>: </span>
                        <span class="bricks_quantity">0</span>
                    </div>
                    <div class="wool d-inline-block px-1" style="border-right: 1px solid black; border-left: 1px solid black;">
                        <i class="fa-brands fa-cotton-bureau"></i>
                        <span>: </span>
                        <span class="wool_quantity">0</span>
                    </div>
                    <div class="wood d-inline-block px-1" style="border-right: 1px solid black; border-left: 1px solid black;">
                        <i class="fa-solid fa-wand-sparkles"></i>
                        <span>: </span>
                        <span class="wood_quantity">0</span>
                    </div>
                    <div class="ore d-inline-block px-1" style="border-right: 1px solid black; border-left: 1px solid black;">
                        <i class="fa-solid fa-mountain-sun"></i>
                        <span>: </span>
                        <span class="ore_quantity">0</span>
                    </div>
                </div>
                <div id="hand_P3" class="hand hand-top text-center">
                    <div class="cereal d-inline-block px-1" style="border-right: 1px solid black; border-left: 1px solid black;">
                        <i class="fa-solid fa-wheat-awn"></i>
                        <span>: </span>
                        <span class="cereal_quantity">0</span>
                    </div>
                    <div class="bricks d-inline-block px-1" style="border-right: 1px solid black; border-left: 1px solid black;">
                        <i class="fa-solid fa-trowel-bricks"></i>
                        <span>: </span>
                        <span class="bricks_quantity">0</span>
                    </div>
                    <div class="wool d-inline-block px-1" style="border-right: 1px solid black; border-left: 1px solid black;">
                        <i class="fa-brands fa-cotton-bureau"></i>
                        <span>: </span>
                        <span class="wool_quantity">0</span>
                    </div>
                    <div class="wood d-inline-block px-1" style="border-right: 1px solid black; border-left: 1px solid black;">
                        <i class="fa-solid fa-wand-sparkles"></i>
                        <span>: </span>
                        <span class="wood_quantity">0</span>
                    </div>
                    <div class="ore d-inline-block px-1" style="border-right: 1px solid black; border-left: 1px solid black;">
                        <i class="fa-solid fa-mountain-sun"></i>
                        <span>: </span>
                        <span class="ore_quantity">0</span>
                    </div>
                </div>
                <div style="background: lightyellow" class="playerprofile" id="P3">
                    <img src="Images/nouser.png" alt="No user" height="100px">
                    <h1>J4</h1>
                    <h3 id="puntos_victoria_J4"></h3>
                    <textarea id="buildings_P4" style="width: 100%"></textarea>
                </div>
            </div>
        </div>

        <!-- Controles -->
        <div class="row" id="controles">
            <div class="col-1 text-center">
                <div class="btn btn-secondary" id="ronda_previa_btn" data-toggle="tooltip" data-placement="top" title="Ronda anterior"><i class="fa-solid fa-angles-left"></i></div>
            </div>
            <div class="col-1 text-center">
                <div class="btn btn-secondary" id="turno_previo_btn" data-toggle="tooltip" data-placement="top" title="Turno anterior"><i class="fa-solid fa-angle-left"></i></div>
            </div>
            <div class="col-1 text-center">
                <div class="btn btn-secondary" id="fase_previa_btn" data-toggle="tooltip" data-placement="top" title="Fase anterior"><i class="fa-solid fa-backward-step"></i></div>
            </div>
            <div class="col text-center">
                <div class="row">
                    <div class="col text-center">
                        <input type="number" class="form-control" id="contador_turnos">
                        <input type="number" class="form-control" id="contador_fases">
                    </div>
                    <div class="col-2 text-center">
                        <div class="btn btn-secondary" id="play_btn" data-toggle="tooltip" data-placement="top" title="Play"><i class="fa-solid fa-play"></i></div>
                        <!--                                <div class="btn btn-secondary" id="double_play_btn" data-toggle="tooltip" data-placement="top" title="Ultra Play"><i class="fa-solid fa-forward"></i></div>-->
                    </div>
                    <div class="col text-center">
                        <input type="number" class="form-control" id="contador_rondas" style="display: inline-block; width: 100px">
                        /
                        <span id="rondas_maximas"></span>
                    </div>
                    <div>
                        <span id="millis_seleccionados"></span>
                        <input type="range" min="10" max="1000" value="25" class="slider" id="millis_for_play">
                    </div>
                </div>
            </div>
            <div class="col-1 text-center">
                <div class="btn btn-secondary" id="fase_siguiente_btn" data-toggle="tooltip" data-placement="top" title="Fase siguiente"><i class="fa-solid fa-forward-step"></i></div>
            </div>
            <div class="col-1 text-center">
                <div class="btn btn-secondary" id="turno_siguiente_btn" data-toggle="tooltip" data-placement="top" title="Turno siguiente"><i class="fa-solid fa-angle-right"></i></div>
            </div>
            <div class="col-1 text-center">
                <div class="btn btn-secondary" id="ronda_siguiente_btn" data-toggle="tooltip" data-placement="top" title="Ronda siguiente"><i class="fa-solid fa-angles-right"></i></div>
            </div>
        </div>

        <!--TODO: Plantear el borrado del log y simplemente imprimirlo por consola. Todo para evitar tener que crear un dump() de Symfony o similar -->
        <!-- Log -->
        <div class="row">
            <div class="col-12">
                <div style="background: pink">
                    <input type="file" id="get_file" accept=".json">
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-12">
                <div id="log" style="background: white; font-family: monospace; height: 100px">

                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        var game_obj = {}
        var round_obj = {}
        var turn_obj = {}
        var phase_obj = {}


        function init_events() {
            let input = jQuery('#get_file');
            input.on('click', function(e) {
                input.val('')
            })

            input.on('change', function(e) {
                var file = document.getElementById("get_file").files[0];
                if (file) {
                    var reader = new FileReader();
                    reader.readAsText(file, "UTF-8");
                    reader.onload = function(evt) {
                        game_obj = JSON.parse(evt.target.result);

                        init_events_with_game_obj()
                        addLogFromJSON()
                        setup()
                    }
                    reader.onerror = function(evt) {
                        console.log('Error al cargar el archivo')
                    }
                }

                for (let i = 1; i < 5; i++) {
                    let textarea = $('#buildings_P' + i)
                    textarea.text('')
                }
                game_obj = {}
                round_obj = {}
                turn_obj = {}
                phase_obj = {}


                jQuery('#puntos_victoria_J1').text(0)
                jQuery('#puntos_victoria_J2').text(0)
                jQuery('#puntos_victoria_J3').text(0)
                jQuery('#puntos_victoria_J4').text(0)
            });


            $(function() {
                $('[data-toggle="tooltip"]').tooltip()
            })
        }

        function addLogFromJSON() {
            $('#contador_rondas').val(1).change()
            $('#contador_turnos').val(1).change()
            $('#contador_fases').val(0).change()

            $('#rondas_maximas').text(Object.keys(game_obj['game']).length)
        }
        
        function addSetupBuildings() {
            setup_obj = game_obj['setup'];

            for (let i = 0; i < 4; i++) {
                let textarea = $('#buildings_P' + (i + 1))
                for (let j = 0; j < setup_obj['P' + i].length; j++) {
                    let node = jQuery('#node_' + setup_obj['P' + i][j]['id']);
                    let road = '';
                    if (setup_obj['P' + i][j]['id'] < setup_obj['P' + i][j]['road']) {
                        road = jQuery('#road_' + setup_obj['P' + i][j]['id'] + '_' + setup_obj['P' + i][j]['road']);
                    } else {
                        road = jQuery('#road_' + setup_obj['P' + i][j]['road'] + '_' + setup_obj['P' + i][j]['id']);
                    }

                    let str = 'node: ' + setup_obj['P' + i][j]['id'] + ' | ' + 'type: ' + 'T' + '\r\n';
                    str += 'node: ' + setup_obj['P' + i][j]['id'] + ' | ' + 'roadTo: ' + setup_obj['P' + i][j]['road'] + ' | ' + 'type: ' + 'R' + '\r\n';

                    textarea.text(textarea.text() + str);

                    paint_it_player_color(i, node);
                    paint_it_player_color(i, road);
                }
            }
        }
        
        function terrainSetup(){
            setup_obj = game_obj['setup'];
            
            
        }
        
        function init_events_with_game_obj() {
            let contador_rondas = jQuery('#contador_rondas');
            let contador_turnos = jQuery('#contador_turnos');
            let contador_fases = jQuery('#contador_fases');

            let ronda_previa_btn = jQuery('#ronda_previa_btn');
            let ronda_siguiente_btn = jQuery('#ronda_siguiente_btn');

            let turno_previo_btn = jQuery('#turno_previo_btn');
            let turno_siguiente_btn = jQuery('#turno_siguiente_btn');

            let fase_previa_btn = jQuery('#fase_previa_btn');
            let fase_siguiente_btn = jQuery('#fase_siguiente_btn');

            let millis_for_play = jQuery('#millis_for_play');
            let play_btn = jQuery('#play_btn');
            let playIntervalNumber = 0;

            contador_rondas.off().on('change', function(e) {
                if (parseInt(contador_rondas.val()) < 1) {
                    contador_rondas.val(1).change();
                }
                if (parseInt(contador_rondas.val()) > Object.keys(game_obj['game']).length) {
                    contador_rondas.val(Object.keys(game_obj['game']).length).change();

                    play_btn.click()
                }

                round_obj = game_obj['game']['round_' + (contador_rondas.val() - 1)];
                contador_turnos.val(1).change();
            })
            contador_turnos.off().on('change', function(e) {

                if (parseInt(contador_turnos.val()) > 4) {
                    contador_turnos.val(1).change()
                    contador_rondas.val(parseInt(contador_rondas.val()) + 1).change()
                    return;
                }
                if (parseInt(contador_turnos.val()) < 1) {
                    if (parseInt(contador_rondas.val()) < 1) {
                        contador_turnos.val(1).change();
                    } else {
                        contador_turnos.val(4).change();
                        contador_rondas.val(parseInt(contador_rondas.val()) - 1).change();
                    }
                    return;
                }

                $('.playerprofile').css('border', 'none')
                switch (parseInt(contador_turnos.val()) - 1) {
                    case 0:
                        $('#P0').css('border', '10px solid red')
                        break;
                    case 1:
                        $('#P1').css('border', '10px solid blue')
                        break;
                    case 2:
                        $('#P2').css('border', '10px solid green')
                        break;
                    case 3:
                        $('#P3').css('border', '10px solid yellow')
                        break;
                }

                turn_obj = round_obj['turn_P' + (contador_turnos.val() - 1)];
                contador_fases.val(1).change();
            })
            contador_fases.off().on('change', function(e) {

                if (parseInt(contador_fases.val()) > 4) {
                    contador_fases.val(1).change();
                    contador_turnos.val(parseInt(contador_turnos.val()) + 1).change();
                    return;
                }
                if (parseInt(contador_fases.val()) < 1) {
                    contador_fases.val(4).change();
                    contador_turnos.val(parseInt(contador_turnos.val()) - 1).change();
                    return;
                }


                switch (parseInt(contador_fases.val()) - 1) {
                    case 0:
                        phase_obj = turn_obj['start_turn'];

                        let diceroll_div = jQuery('#diceroll');
                        diceroll_div.text('Diceroll: ' + phase_obj['dice']);
                        for (let i = 0; i < 4; i++) {
                            changeHandObject(i);
                        }
                        break;
                    case 1:
                        phase_obj = turn_obj['commerce_phase'];

                        let log = jQuery('#log');
                        log.empty();

                        let html = '';


                        for (let i = 0; i < phase_obj.length; i++) {
                            if (phase_obj[i]['trade_offer'] !== 'None' && !phase_obj[i]['inviable']) {
                                if (phase_obj[i]['harbor_trade']) {
                                    // TODO:
                                } else {

                                    html += '<div class="offer"><p>';
                                    html += '<span>P' + contador_turnos.val() + ': Offer</span>';
                                    html += '<br><span class="gives">';
                                    html += 'Gives: ' + 'Cereal: ' + phase_obj[i]['trade_offer']['gives']['cereal'] + ' | ';
                                    html += 'Mineral: ' + phase_obj[i]['trade_offer']['gives']['mineral'] + ' | ';
                                    html += 'Wool: ' + phase_obj[i]['trade_offer']['gives']['wool'] + ' | ';
                                    html += 'Wood: ' + phase_obj[i]['trade_offer']['gives']['wood'] + ' | ';
                                    html += 'Clay: ' + phase_obj[i]['trade_offer']['gives']['clay'] + '</span>';

                                    html += '<br><span class="receives">';
                                    html += 'Receives: ' + 'Cereal: ' + phase_obj[i]['trade_offer']['receives']['cereal'] + ' | ';
                                    html += 'Mineral: ' + phase_obj[i]['trade_offer']['receives']['mineral'] + ' | ';
                                    html += 'Wool: ' + phase_obj[i]['trade_offer']['receives']['wool'] + ' | ';
                                    html += 'Wood: ' + phase_obj[i]['trade_offer']['receives']['wood'] + ' | ';
                                    html += 'Clay: ' + phase_obj[i]['trade_offer']['receives']['clay'] + '</span>';
                                    html += '</p></div>';

                                    html += '<div class="answers">';

                                    for (let j = 0; j < phase_obj[i]['answers'].length; j++) {
                                        html += '<div><p>';
                                        html += '<span>' + phase_obj[i]['answers'][j]['player'];
                                        if (phase_obj[i]['answers'][j]['response'] == true) {
                                            if (phase_obj[i]['answers'][j]['completed']) {
                                                html += ': true </span>';
                                            } else {
                                                html += ': true | Cannot be completed (lack of materials)</span>';
                                            }
                                        } else if (phase_obj[i]['answers'][j]['response'] == false) {
                                            html += ': false </span>';
                                        } else {
                                            html += ': counteroffer </span>';
                                            html += '<br><span class="counteroffer_gives">'
                                            html += 'Gives: ' + 'Cereal: ' + phase_obj[i]['answers'][j]['response']['gives']['cereal'] + ' | ';
                                            html += 'Mineral: ' + phase_obj[i]['answers'][j]['response']['gives']['mineral'] + ' | ';
                                            html += 'Wool: ' + phase_obj[i]['answers'][j]['response']['gives']['wool'] + ' | ';
                                            html += 'Wood: ' + phase_obj[i]['answers'][j]['response']['gives']['wood'] + ' | ';
                                            html += 'Clay: ' + phase_obj[i]['answers'][j]['response']['gives']['clay'] + '</span>';
                                            html += '<br><span class="counteroffer_receives">'
                                            html += 'Receives: ' + 'Cereal: ' + phase_obj[i]['answers'][j]['response']['receives']['cereal'] + ' | ';
                                            html += 'Mineral: ' + phase_obj[i]['answers'][j]['response']['receives']['mineral'] + ' | ';
                                            html += 'Wool: ' + phase_obj[i]['answers'][j]['response']['receives']['wool'] + ' | ';
                                            html += 'Wood: ' + phase_obj[i]['answers'][j]['response']['receives']['wood'] + ' | ';
                                            html += 'Clay: ' + phase_obj[i]['answers'][j]['response']['receives']['clay'] + '</span>';

                                            html += '<br><span class="counteroffer_answer">P' + contador_turnos.val();
                                            if (phase_obj[i]['answers'][j]['giver_answer']) {
                                                if (phase_obj[i]['answers'][j]['completed']) {
                                                    html += ': true </span>';
                                                } else {
                                                    html += ': true | Cannot be completed (lack of materials)</span>';
                                                }
                                            } else {
                                                html += ': false </span>';
                                            }
                                        }

                                        html += '</p></div>'
                                    }

                                    html += '</div>'
                                }

                                log.append(html)
                            }

                        }
                        break;
                    case 2:
                        phase_obj = turn_obj['build_phase'];
                        let textarea = $('#buildings_P' + contador_turnos.val())
                        for (let i = 0; i < phase_obj.length; i++) {
                            let building = phase_obj[i]
                            if (building['building'] !== null) {
                                switch (building['building']) {
                                    case 'town':
                                        console.log('town')
                                        if (building['finished']) {
                                            let node = jQuery('#node_' + building['nodeID'])
                                            paint_it_player_color((parseInt(contador_turnos.val()) - 1), node);

                                            let str = 'node: ' + building['nodeID'] + ' | ' + 'type: ' + 'T' + '\r\n'
                                            textarea.text(textarea.text() + str)

                                        }
                                        break;
                                    case 'city':
                                        console.log('city')
                                        if (building['finished']) {
                                            let node = jQuery('#node_' + building['nodeID'])
                                            node.text('C');

                                            let str = 'node: ' + building['nodeID'] + ' | ' + 'type: ' + 'C' + '\r\n'
                                            textarea.text(textarea.text() + str)
                                        }
                                        break;
                                    case 'road':
                                        console.log('road')
                                        if (building['finished']) {
                                            let road = '';
                                            if (building['nodeID'] < building['roadTo']) {
                                                road = jQuery('#road_' + building['nodeID'] + '_' + building['roadTo']);
                                            } else {
                                                road = jQuery('#road_' + building['roadTo'] + '_' + building['nodeID']);
                                            }
                                            paint_it_player_color((parseInt(contador_turnos.val()) - 1), road);
                                            let str = 'node: ' + building['nodeID'] + ' | ' + 'roadTo: ' + building['roadTo'] + ' | ' + 'type: ' + 'R' + '\r\n'
                                            textarea.text(textarea.text() + str)
                                        }
                                        break;
                                    case 'card':
                                        break;
                                    default:
                                        break;
                                }
                            }
                        }
                        break;
                    case 3:
                        phase_obj = turn_obj['end_turn'];
                        let winner = '';

                        for (let i = 0; i < 4; i++) {
                            jQuery('#puntos_victoria_J' + (i + 1)).text(phase_obj['victory_points']['J' + i])
                            if (parseInt(phase_obj['victory_points']['J' + i]) >= 10) {
                                winner = 'J' + (i + 1) + ' GANA'
                            }
                        }

                        if (winner !== '' && contador_turnos.val() >= 4) {
                            alert(winner);
                        }
                        break;

                }
            })


            //-------------------------------------------------
            ronda_previa_btn.off().on('click', function(e) {
                let value = parseInt(contador_rondas.val())
                contador_rondas.val(value - 1).change()
            })
            ronda_siguiente_btn.off().on('click', function(e) {
                let value = parseInt(contador_rondas.val())
                contador_rondas.val(value + 1).change()
            })

            //-------------------------------------------------
            turno_previo_btn.off().on('click', function(e) {
                let value = parseInt(contador_turnos.val())
                contador_turnos.val(value - 1).change()
            })
            turno_siguiente_btn.off().on('click', function(e) {
                let value = parseInt(contador_turnos.val())
                contador_turnos.val(value + 1).change()
            })

            //-------------------------------------------------
            fase_previa_btn.off().on('click', function(e) {
                let value = parseInt(contador_fases.val())
                contador_fases.val(value - 1).change()
            })
            fase_siguiente_btn.off().on('click', function(e) {
                let value = parseInt(contador_fases.val())
                contador_fases.val(value + 1).change()

                //                if (parseInt(contador_fases.val()) == 0){}
                //TODO
            })

            millis_for_play.off().on('change', function(e) {
                jQuery('#millis_seleccionados').val(millis_for_play.val());
            })

            play_btn.off().on('click', function(e) {
                let _this = $(this);
                let _i = _this.find('i');

                if (_i.hasClass('fa-play')) {
                    _i.removeClass('fa-play').addClass('fa-pause');

                    _this.attr('title', 'Pause')

                    //                    playIntervalNumber = setInterval(function() {
                    //                        turno_siguiente_btn.click()
                    //                    }, 500)
                    playIntervalNumber = setInterval(function() {
                        fase_siguiente_btn.click()
                    }, millis_for_play.val())

                } else {
                    _this.attr('title', 'Play')

                    _i.removeClass('fa-pause').addClass('fa-play');
                    clearInterval(playIntervalNumber)
                }

                $(function() {
                    _this.tooltip('dispose')
                    _this.tooltip()
                })
            })
        }

        function changeHandObject(player) {
            //TODO: Debería de alguna manera mostrar que materiales se han actualizado. Si son iguales no deberían de recalcarse
            hand_obj = phase_obj['hand_P' + player];
            $('#hand_P' + player + ' .cereal_quantity').text(hand_obj['cereal']).change();
            $('#hand_P' + player + ' .bricks_quantity').text(hand_obj['clay']).change();
            $('#hand_P' + player + ' .wood_quantity').text(hand_obj['wood']).change();
            $('#hand_P' + player + ' .wool_quantity').text(hand_obj['wool']).change();
            $('#hand_P' + player + ' .ore_quantity').text(hand_obj['mineral']).change();
        }

        // utilities
        function paint_it_player_color(player, object_to_paint) {
            object_to_paint = jQuery(object_to_paint);
            switch (player) {
                case 0:
                    object_to_paint.css('background', 'lightcoral');
                    break;
                case 1:
                    object_to_paint.css('background', 'lightblue');
                    break;
                case 2:
                    object_to_paint.css('background', 'lightgreen');
                    break;
                case 3:
                    object_to_paint.css('background', 'lightyellow');
                    break;
                default:
                    console.log('Jugador: ' + player)
                    alert('Caso ilegal')
                    break;
            }
        }

        
        function setup(){
            terrainSetup();
            addSetupBuildings();
        }
        
        // init()
        window.addEventListener('load', function() {
            init_events();
        }, false);

    </script>
</body>

</html>
